alias: Huawei Solar STOP Hold Export
description: >-
  Hold export demand until the state of charge is greater than minimum. Adjusts
  discharging and charging power to maintain optimal operation.
mode: single
sequence:
  - if:
      - condition: not
        conditions:
          - condition: template
            value_template: >
              {{ states('sensor.batteries_forcible_charge') not in ['Stopped',
              'Idle'] }}
    then:
      - data:
          device_id: 6893ee838a0972bd3e50d9e0faa0ba5a
        action: huawei_solar.stop_forcible_charge
  - if:
      - condition: template
        value_template: >-
          {% set v = states('number.battery_maximum_discharging_power') %} {{ v
          not in ['unknown','unavailable'] and (v | int) != 5000 }}
    then:
      - delay:
          seconds: 10
      - target:
          entity_id: number.battery_maximum_discharging_power
        data:
          value: 5000
        action: number.set_value
  - if:
      - condition: template
        value_template: >-
          {% set v = states('number.battery_maximum_charging_power') %} {{ v not
          in ['unknown','unavailable'] and (v | int) != 5000 }}
    then:
      - delay:
          seconds: 10
      - target:
          entity_id: number.battery_maximum_charging_power
        data:
          value: 5000
        action: number.set_value
